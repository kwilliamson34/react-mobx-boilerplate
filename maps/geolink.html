<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Geolink Map</title>

  <style type="text/css">
    body {
      margin: 0;
    }
  </style>

  <!-- Geolink Widget stylesheets -->
  <link rel="stylesheet" type="text/css" href="@@geolinkScriptPath/libs/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <link rel="stylesheet" type="text/css" href="@@geolinkScriptPath/libs/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" type="text/css" href="@@geolinkScriptPath/assets/stylesheets/abMap.css" />
</head>

<body>
  <div ng-app="appBoardsMap">
    <div style="height:100vh;width:100%;" ab-map config="{defaultBaseLayerName: 'bingRoadAndBase', scrollWheelZoom: false, center: {'lat':40,'lng':-99,'zoom':4}}"></div>
  </div>

  <script type="text/javascript" src="@@geolinkScriptPath/extns/@@geolinkAbMapConstantsFileName" data-ngmod="appBoardsMap"></script>
  <script type="text/javascript" src="@@geolinkScriptPath/extns/abMapConstantsCloudFN.js" data-ngmod="appBoardsMap"></script>

  <script type="text/javascript" src="@@geolinkScriptPath/libs/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="@@geolinkScriptPath/libs/amplify/lib/amplify.min.js"></script>
  <script type="text/javascript" src="@@geolinkScriptPath/libs/angular/angular.min.js"></script>

  <script type="text/javascript" src="@@geolinkScriptPath/libs/leaflet/dist/leaflet.js"></script>
  <script type="text/javascript" src="@@geolinkScriptPath/libs/leaflet-plugins/layer/tile/Bing.js"></script>
  <script type="text/javascript" src="@@geolinkScriptPath/libs/esri-leaflet/dist/esri-leaflet.js"></script>

  <script type="text/javascript" src="@@geolinkScriptPath/directives/abMap.js" data-ngmod="appBoardsMap"></script>
  <script type="text/javascript" src="@@geolinkScriptPath/extns/abMapLeafletPlugins.js"></script>
  <script type="text/javascript" src="@@geolinkScriptPath/services/abMapLayerLoaderFactory.js" data-ngmod="appBoardsMap"></script>
  <script type="text/javascript" src="@@geolinkScriptPath/services/abMapUtilFactory.js" data-ngmod="appBoardsMap"></script>
  <script type="text/javascript" src="@@geolinkScriptPath/services/abMapEventFactory.js" data-ngmod="appBoardsMap"></script>
  <script type="text/javascript" src="@@geolinkScriptPath/libs/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

  <script type="text/javascript">
    window.onload = function() {
      parent.iframeLoaded();
    }

    window.onmessage = function(e){
      if(typeof amplify != 'undefined'){
        console.log('Geolink API call initiated:');
        console.log(e.data);
        if(e.data.filters) {
          amplify.publish(e.data.eventName, e.data.value, e.data.flag, e.data.filters);
        } else if (e.data.value) {
          amplify.publish(e.data.eventName, e.data.value, e.data.flag);
        } else if (e.data.options) {
          amplify.publish(e.data.eventName, e.data.options);
        } else {
          amplify.publish(e.data.eventName);
        }
      } else {
        console.error('Geolink access denied (improper cookie). The amplify library has not been loaded and the map will not work.');
      }
    };
  </script>
</body>

</html>
